{% extends 'base.html' %} 
{% block content %}

<div class="row">
  <div class="col-sm-6">
    <form action="." method="GET" class="form-inline">
      <input type="text" id="search" name="search" class="form-control" placeholder="Busca">
      <input type="submit" class="btn btn-primary" style="margin-left: 10px;" value="Buscar">
    </form>
  </div>
</div>

<div class="page-reader">
  <h2>
    Estoque
    <span class="pull-right">
      <a href="{% url 'produto:produto_add' %}">
        <button type="button" class="btn btn-primary">
        <span class="fa-plus fa"></span> Adicionar produto
        </button>
      </a>
    </span>
  </h2>

  {% if object_list %}

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Preço</th>
        <th class="text-center">Estoque</th>
        <th class="text-center">Estoque Minimo</th>
        <th class="text-center">Categoria</th>
        <th class="text-center">Editar</th>
        <th class="text-center">Excluir</th>
      </tr>
    </thead>
    <tbody>
      {% for object in object_list %}
      <tr>
        <td><a href="{{object.get_absolute_url}}">{{ object.nome}}</a></td>
        <td>R$ <span class="pull-right">{{ object.preco }}</span></td>       
        <td class="text-center">{{ object.estoque }}</td>
        <td class="text-center">{{ object.estoque_minimo }}</td> 
        <td class="text-center">{{ object.categoria }}</td> 
        <td class="text-center">
          <a href="{% url 'produto:produto_edit' object.pk %}">
            <button type="button" class="btn btn-success">
              <span class="fa fa-pencil"></span>
            </button>
          </a>
        </td>
        <td class="text-center">
          <button type="button" class="btn btn-danger" onclick="confirmDelete('{{ object.pk }}')">
            <span class="fa fa-trash"></span>
          </button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="alert alert-warning">Sem itens na lista</p>
  {% endif %}
</div>

<script type="text/javascript">
  function confirmDelete(productId) {
    // Exibe o alert de confirmação
    var confirmAction = confirm("Tem certeza de que deseja excluir este produto?");
    
    if (confirmAction) {
      // Se confirmado, envia o formulário
      var form = document.createElement("form");
      form.method = "POST";
      form.action = "{% url 'produto:produto_delete' 0 %}".replace("0", productId);
      
      // Adiciona o CSRF token
      var csrfToken = document.querySelector("[name=csrfmiddlewaretoken]").value;
      var csrfInput = document.createElement("input");
      csrfInput.type = "hidden";
      csrfInput.name = "csrfmiddlewaretoken";
      csrfInput.value = csrfToken;
      form.appendChild(csrfInput);
      
      document.body.appendChild(form);
      form.submit();
    }
  }
</script>

{% endblock content %}
